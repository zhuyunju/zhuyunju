<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | 会飞的猪</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="猪的学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.7cfabf05.css" as="style"><link rel="preload" href="/assets/js/app.32184412.js" as="script"><link rel="preload" href="/assets/js/2.bf4cfade.js" as="script"><link rel="preload" href="/assets/js/3.cb83fe4d.js" as="script"><link rel="prefetch" href="/assets/js/10.2fce3ca8.js"><link rel="prefetch" href="/assets/js/11.14bf95bb.js"><link rel="prefetch" href="/assets/js/12.1c7f07f1.js"><link rel="prefetch" href="/assets/js/13.24734bd0.js"><link rel="prefetch" href="/assets/js/14.dd2da934.js"><link rel="prefetch" href="/assets/js/15.4ad28d33.js"><link rel="prefetch" href="/assets/js/16.2c8457dd.js"><link rel="prefetch" href="/assets/js/17.dd734ec5.js"><link rel="prefetch" href="/assets/js/4.5ea218e0.js"><link rel="prefetch" href="/assets/js/5.cdd70e81.js"><link rel="prefetch" href="/assets/js/6.4310bead.js"><link rel="prefetch" href="/assets/js/7.a4a5042a.js"><link rel="prefetch" href="/assets/js/8.07aa2d75.js"><link rel="prefetch" href="/assets/js/9.1b6d8249.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7cfabf05.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="会飞的猪" class="logo"> <span class="site-name can-hide">会飞的猪</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/html5orcss/" class="nav-link">
  HTML5+CSS
</a></li><li class="dropdown-item"><!----> <a href="/notes/WEP/" class="nav-link">
  前端移动进阶
</a></li><li class="dropdown-item"><!----> <a href="/notes/Js/" class="nav-link">
  Web APIs
</a></li><li class="dropdown-item"><!----> <a href="/notes/AJAX/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/notes/Node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  uniapp
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="人工智能" class="dropdown-title"><span class="title">人工智能</span> <span class="arrow down"></span></button> <button type="button" aria-label="人工智能" class="mobile-dropdown-title"><span class="title">人工智能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AI/numpy/" class="nav-link">
  numpy
</a></li><li class="dropdown-item"><!----> <a href="/AI/pandas/" class="nav-link">
  pandas
</a></li><li class="dropdown-item"><!----> <a href="/AI/matplotib/matplotib.html" class="nav-link">
  matplotib
</a></li><li class="dropdown-item"><!----> <a href="/AI/tensorflow/tensorflow.html" class="nav-link">
  tensorflow
</a></li></ul></div></div> <a href="https://gitee.com/zhu-yunju" target="_blank" rel="noopener noreferrer" class="repo-link">
    码云
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/html5orcss/" class="nav-link">
  HTML5+CSS
</a></li><li class="dropdown-item"><!----> <a href="/notes/WEP/" class="nav-link">
  前端移动进阶
</a></li><li class="dropdown-item"><!----> <a href="/notes/Js/" class="nav-link">
  Web APIs
</a></li><li class="dropdown-item"><!----> <a href="/notes/AJAX/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/notes/Node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  uniapp
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="人工智能" class="dropdown-title"><span class="title">人工智能</span> <span class="arrow down"></span></button> <button type="button" aria-label="人工智能" class="mobile-dropdown-title"><span class="title">人工智能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AI/numpy/" class="nav-link">
  numpy
</a></li><li class="dropdown-item"><!----> <a href="/AI/pandas/" class="nav-link">
  pandas
</a></li><li class="dropdown-item"><!----> <a href="/AI/matplotib/matplotib.html" class="nav-link">
  matplotib
</a></li><li class="dropdown-item"><!----> <a href="/AI/tensorflow/tensorflow.html" class="nav-link">
  tensorflow
</a></li></ul></div></div> <a href="https://gitee.com/zhu-yunju" target="_blank" rel="noopener noreferrer" class="repo-link">
    码云
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/notes/Node/" aria-current="page" class="active sidebar-link">Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Node/#node-js与内置模块" class="sidebar-link">Node.js与内置模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Node/#node-js-2" class="sidebar-link">Node.js</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#fs文件系统模块" class="sidebar-link">fs文件系统模块</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#path路径模块" class="sidebar-link">path路径模块</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#http模块" class="sidebar-link">http模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/Node/#模块化" class="sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Node/#模块化的基本概念" class="sidebar-link">模块化的基本概念</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#node-js模块化" class="sidebar-link">Node.js模块化</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#npm与包" class="sidebar-link">npm与包</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/Node/#express" class="sidebar-link">Express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Node/#express简介" class="sidebar-link">Express简介</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#express路由" class="sidebar-link">Express路由</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#express中间件" class="sidebar-link">Express中间件</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#使用express写接口" class="sidebar-link">使用Express写接口</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/Node/#数据库与身份认证" class="sidebar-link">数据库与身份认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/Node/#数据库的基本概念" class="sidebar-link">数据库的基本概念</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#mysql的基本使用" class="sidebar-link">MySQL的基本使用</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#在项目中操作mysql" class="sidebar-link">在项目中操作MySQL</a></li><li class="sidebar-sub-header"><a href="/notes/Node/#前后的的身份认证" class="sidebar-link">前后的的身份认证</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js"><a href="#node-js" class="header-anchor">#</a> Node.js</h1> <h2 id="node-js与内置模块"><a href="#node-js与内置模块" class="header-anchor">#</a> Node.js与内置模块</h2> <h3 id="node-js-2"><a href="#node-js-2" class="header-anchor">#</a> Node.js</h3> <blockquote><p>Node.js® is a JavaScript runtime built on Chrome's V8 JavaScript engine.
Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。
<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">Node.js官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h4> <ul><li>基于 Express 框架（http://www.expressjs.com.cn/），可以快速构建 Web 应用</li> <li>基于 Electron 框架（https://electronjs.org/），可以构建跨平台的桌面应用</li> <li>基于 restify 框架（http://restify.com/），可以快速构建 API 接口项目</li> <li>读写和操作数据库、创建实用的命令行工具辅助前端开发</li></ul> <h3 id="fs文件系统模块"><a href="#fs文件系统模块" class="header-anchor">#</a> fs文件系统模块</h3> <blockquote><p>fs 模块是 Node.js 官方提供的、用来操作文件的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求</p></blockquote> <ul><li>fs.readFile()方法,用来读取指定文件中的内容
<ul><li>参数1：<strong>必选</strong>参数文件路径</li> <li>参数2：可选参数编码格式读取</li> <li>参数3：<strong>必选</strong>参数回调函数拿取数据</li></ul></li> <li>fs.writeFile()方法,用来向指定文件中写入内容
<ul><li>参数1：<strong>必选</strong>参数文件路径</li> <li>参数2：<strong>必选</strong>参数，表示写入的内容</li> <li>参数3：可选参数编码格式读取</li> <li>参数4：<strong>必选</strong>参数回调函数</li></ul></li> <li>语法:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在javascipt使用fs模块需要先导入</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 1、fs.readFile()语法格式</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/1.text'</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 2.fs.writeFile()</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./files/1.text'</span><span class="token punctuation">,</span><span class="token string">'Hello Node.js'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="fs模块-动态拼接问题"><a href="#fs模块-动态拼接问题" class="header-anchor">#</a> fs模块-动态拼接问题</h4> <blockquote><p>在使用 fs 模块操作文件时，如果提供的操作路径是以 <strong>./</strong> 或 <strong>../</strong> 开头的<strong>相对路径</strong>时，很容易出现路径动态拼接错误的问题。
原因：代码在运行的时候，<strong>会以执行 node 命令时所处的目录</strong>，动态拼接出被操作文件的完整路径。
解决方案：在使用 fs 模块操作文件时，<strong>直接提供完整的路径</strong>，不要提供 ./ 或 ../ 开头的相对路径，从而防止路径动态拼接的问题。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><font style="color:red;">_dirname表示当前文件所处目录</font></p></div> <h3 id="path路径模块"><a href="#path路径模块" class="header-anchor">#</a> path路径模块</h3> <blockquote><p>path 模块是 Node.js 官方提供的、用来处理路径的模块。它提供了一系列的方法和属性，用来满足用户对路径的处理
需求。</p></blockquote> <ul><li><p>path.join() 方法，用来将多个路径片段拼接成一个完整的路径字符串</p> <ul><li><code>path.join([...paths])</code></li> <li>...paths string  路径片段的序列</li> <li>返回值: string</li></ul></li> <li><p>path.basename() 方法，用来从路径字符串中，将文件名解析出来</p> <ul><li><code>path.basename(path[,ext])</code></li> <li>path string 必选参数，表示一个路径的字符串</li> <li>ext string 可选参数，表示文件扩展名</li> <li>返回: string 表示路径中的最后一部分</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// path.join() 方法</span>
    <span class="token keyword">const</span> fpath <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> pathStr <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>_dirname<span class="token punctuation">,</span><span class="token string">'/e'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathStr<span class="token punctuation">)</span>  <span class="token comment">// 输出： 当前目录位置\e</span>
    

    <span class="token comment">// path.basename() 方法</span>
    <span class="token keyword">const</span> fpath <span class="token operator">=</span> <span class="token string">'/a/b/c/index.html'</span> <span class="token comment">//文件路径</span>

    <span class="token keyword">var</span> fullname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fpath<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fullname<span class="token punctuation">)</span>   <span class="token comment">//输出 index.html</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>获取文件扩展名：path.extname()
<ul><li><code>path.extname(path)</code></li> <li>path string 必选参数，表示一个路径的字符串</li> <li>返回: string 返回得到的扩展名字符串</li></ul></li></ul> <h3 id="http模块"><a href="#http模块" class="header-anchor">#</a> http模块</h3> <blockquote><p>http 模块是 Node.js 官方提供的、用来创建 web 服务器的模块。通过 http 模块提供的 http.createServer() 方法，就
能方便的把一台普通的电脑，变成一台 Web 服务器，从而对外提供 Web 资源服务。</p></blockquote> <h4 id="创建基本的web服务器"><a href="#创建基本的web服务器" class="header-anchor">#</a> 创建基本的web服务器</h4> <ul><li>创建Web服务器的基本步骤
<ul><li>导入http模块</li> <li>创建web服务器实例</li> <li>为服务器绑定request事件,监听客服端的请求</li> <li>启动服务器</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导入http模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建web服务器实例</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 为服务器绑定request事件,监听客服端的请求</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只要客户端请求自己的服务器就会触发request事件,从而调用这个事件处理函数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'someone vist our server.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'htpp server runing at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="req请求对象"><a href="#req请求对象" class="header-anchor">#</a> req请求对象</h5> <ul><li>req 请求对象包含了与客户端相关的属性和数据，例如</li> <li>req.url 是客户端请求的url地址</li> <li>req.method 是客户端的method请求类型</li></ul> <h5 id="res请响应象"><a href="#res请响应象" class="header-anchor">#</a> res请响应象</h5> <ul><li>res 是响应对象,包含了服务器相关的数据和属性，例如</li> <li>res.end(str)向客户端发送指定内容,并结束这次请求处理过程</li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>解决中文乱码问题</p> <blockquote><p>当调用 res.end() 方法，向客户端发送中文内容的时候，会出现乱码问题，此时，需要手动设置内容的编码格式：
<strong>res.setHeader('Content-Type','text/html;charset=utf-8')</strong></p></blockquote></div> <h2 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h2> <h3 id="模块化的基本概念"><a href="#模块化的基本概念" class="header-anchor">#</a> 模块化的基本概念</h3> <blockquote><p>模块化是指解决一个复杂问题时，自顶向下逐层把系统划分成若干模块的过程。对于整个系统来说，模块是可组合、分解和更换的单元。</p></blockquote> <h3 id="node-js模块化"><a href="#node-js模块化" class="header-anchor">#</a> Node.js模块化</h3> <h4 id="node-js中模块的分类"><a href="#node-js中模块的分类" class="header-anchor">#</a> Node.js中模块的分类</h4> <ul><li>内置模块（内置模块是由 Node.js 官方提供的，例如 fs、path、http 等）</li> <li>（用户创建的每个 .js 文件，都是自定义模块）</li> <li>（由第三方开发出来的模块，并非官方提供的内置模块，也不是用户创建的自定义模块，使用前需要先下载）</li></ul> <h4 id="加载模块"><a href="#加载模块" class="header-anchor">#</a> 加载模块</h4> <blockquote><p>使用强大的 require() 方法，可以加载需要的内置模块、用户自定义模块、第三方模块进行使用。</p></blockquote> <h4 id="模块作用域"><a href="#模块作用域" class="header-anchor">#</a> 模块作用域</h4> <blockquote><p>和函数作用域类似，在自定义模块中定义的变量、方法等成员，只能在当前模块内被访问，这种模块级别的访问限制，叫做模块作用域。</p></blockquote> <ul><li>好处
<ul><li>防止了全局变量污染的问题</li></ul></li></ul> <h4 id="向外共享模块作用域中的成员"><a href="#向外共享模块作用域中的成员" class="header-anchor">#</a> 向外共享模块作用域中的成员</h4> <ul><li>module对象
<ul><li>在每个 .js 自定义模块中都有一个 module 对象，它里面存储了和当前模块有关的信息</li></ul></li> <li>module.exports对象
<ul><li>在自定义模块中，可以使用 module.exports 对象，将模块内的成员共享出去，供外界使用。
外界用 require() 方法导入自定义模块时，得到的就是 module.exports 所指向的对象。</li></ul></li> <li>共享成员时的注意点
<ul><li>使用 require() 方法导入模块时，导入的结果，<strong>永远以 module.exports 指向的对象为准。</strong></li></ul></li> <li>exports对象
<ul><li>由于 module.exports 单词写起来比较复杂，为了简化向外共享成员的代码，Node 提供了 exports 对象。默认情况下，exports 和 module.exports 指向同一个对象。最终共享的结果，还是以 module.exports 指向的对象为准。</li></ul></li></ul> <h4 id="node-js中模块化规范"><a href="#node-js中模块化规范" class="header-anchor">#</a> Node.js中模块化规范</h4> <blockquote><p>Node.js 遵循了 CommonJS 模块化规范，CommonJS 规定了模块的特性和各模块之间如何相互依赖。</p></blockquote> <ul><li>每个模块内部，module 变量代表当前模块。</li> <li>module 变量是一个对象，它的 exports 属性（即 module.exports）是对外的接口。</li> <li>加载某个模块，其实是加载该模块的 module.exports 属性。require() 方法用于加载模块。</li></ul> <h3 id="npm与包"><a href="#npm与包" class="header-anchor">#</a> npm与包</h3> <ul><li>什么是包
<ul><li>Node.js 中的第三方模块又叫做包。</li></ul></li> <li>包的来源
<ul><li>不同于 Node.js 中的内置模块与自定义模块，包是由第三方个人或团队开发出来的，免费供所有人使用。</li></ul></li> <li>为什么需要包
<ul><li>由于 Node.js 的内置模块仅提供了一些底层的 API，导致在基于内置模块进行项目开发的时，效率很低。
包是基于内置模块封装出来的，提供了更高级、更方便的 API，极大的提高了开发效率。
包和内置模块之间的关系，类似于 jQuery 和 浏览器内置 API 之间的关系。
<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">npm官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h2 id="express"><a href="#express" class="header-anchor">#</a> Express</h2> <h3 id="express简介"><a href="#express简介" class="header-anchor">#</a> Express简介</h3> <blockquote><p>官方给出的概念：Express 是基于 Node.js 平台，快速、开放、极简的 Web 开发框架。
通俗的理解：Express 的作用和 Node.js 内置的 http 模块类似，是专门用来创建 Web 服务器的。
Express 的本质：就是一个 npm 上的第三方包，提供了快速创建 Web 服务器的便捷方法。
<a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener noreferrer">Express官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="express的基本使用"><a href="#express的基本使用" class="header-anchor">#</a> Express的基本使用</h4> <ul><li>安装:<code>npm install express</code></li></ul> <h5 id="_1、创建基本的web服务器"><a href="#_1、创建基本的web服务器" class="header-anchor">#</a> 1、创建基本的Web服务器</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建web服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server runing at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_2、监听get请求"><a href="#_2、监听get请求" class="header-anchor">#</a> 2、监听Get请求</h5> <p><code>app.get('请求路径URL',function(req,res){/*处理函数*/})</code></p> <ul><li>参数1：客户端请求URL地址</li> <li>参数2：请求对应的处理函数</li> <li>req:亲求对象</li> <li>res:响应对象</li></ul> <h5 id="_3、监听post请求"><a href="#_3、监听post请求" class="header-anchor">#</a> 3、监听Post请求</h5> <p><code>app.post('请求路径URL',function(req,res){/*处理函数*/)</code></p> <ul><li>参数1：客户端请求URL地址</li> <li>参数2：请求对应的处理函数</li> <li>req:亲求对象</li> <li>res:响应对象</li></ul> <h5 id="_4、把内容响应给客户端"><a href="#_4、把内容响应给客户端" class="header-anchor">#</a> 4、把内容响应给客户端</h5> <p><strong>通过res.send()方法</strong>,发送给客户端</p> <h5 id="_5、获取url中携带的参数"><a href="#_5、获取url中携带的参数" class="header-anchor">#</a> 5、获取URL中携带的参数</h5> <blockquote><p>通过 req.query 对象，可以访问到客户端通过查询字符串的形式，发送到服务器的参数：</p></blockquote> <h5 id="_6、获取url中的动态参数"><a href="#_6、获取url中的动态参数" class="header-anchor">#</a> 6、获取URL中的动态参数</h5> <blockquote><p>通过 req.params 对象，可以访问到 URL 中，通过 : 匹配到的动态参数</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 获取URL中携带的参数</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取URL中的动态参数</span>
     app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:id'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="托管静态资源"><a href="#托管静态资源" class="header-anchor">#</a> 托管静态资源</h4> <h4 id="_1、express-static"><a href="#_1、express-static" class="header-anchor">#</a> 1、express.static()</h4> <blockquote><p>express 提供了一个非常好用的函数，叫做 express.static()，通过它，我们可以非常方便地创建一个静态资源服务器，例如，通过如下代码就可以将 public 目录下的图片、CSS 文件、JavaScript 文件对外开放访问了：
<code>app.use(express.static('public'))</code>
注意：Express 在指定的静态目录中查找文件，并对外提供资源的访问路径。
因此，<strong>存放静态文件的目录名不会出现在 URL 中</strong>。</p></blockquote> <h5 id="托管多个静态资源目录"><a href="#托管多个静态资源目录" class="header-anchor">#</a> 托管多个静态资源目录</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">sattic</span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="挂载路径前缀"><a href="#挂载路径前缀" class="header-anchor">#</a> 挂载路径前缀</h5> <ul><li>如果希望在托管的静态资源访问路径之前，挂载路径前缀，则可以使用如下的方式：
<code>app.use('/public',express.sattic('public'))</code></li></ul> <h3 id="express路由"><a href="#express路由" class="header-anchor">#</a> Express路由</h3> <h4 id="路由的概念"><a href="#路由的概念" class="header-anchor">#</a> 路由的概念</h4> <blockquote><p>路由：广义上来讲，路由就是映射关系。在 Express 中，路由指的是客户端的请求与服务器处理函数之间的映射关系。</p></blockquote> <ul><li>1、在 Express 中，路由指的是<strong>客户端的请求</strong>与<strong>服务器处理函数</strong>之间的<strong>映射关系</strong>。</li> <li>2、Express中路由的例子</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 匹配GET请求,且请求URL为/</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 匹配POST请求,且请求URL为/</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Got a Post request'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>3、路由的匹配过程</li></ul> <blockquote><p>每当一个请求到达服务器之后，<strong>需要先经过路由的匹配</strong>，只有匹配成功之后，才会调用对应的处理函数。
在匹配时，会按照路由的顺序进行匹配，如果<strong>请求类型</strong>和<strong>请求的 URL</strong> 同时匹配成功，则 Express 会将这次请求，转交给对应的 function 函数进行处理。</p></blockquote> <h4 id="路由的使用"><a href="#路由的使用" class="header-anchor">#</a> 路由的使用</h4> <h5 id="最简单的用法"><a href="#最简单的用法" class="header-anchor">#</a> 最简单的用法</h5> <p>在 Express 中使用路由最简单的方式，就是把路由挂载到 app 上，示例代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建web服务器,命名为app</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 挂载路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Got a Post request'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server runing at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="模块化路由"><a href="#模块化路由" class="header-anchor">#</a> 模块化路由</h5> <blockquote><p>为了方便对路由进行模块化的管理，Express 不建议将路由直接挂载到 app 上，而是推荐将路由抽离为单独的模块。
将路由抽离为单独模块的步骤如下：
将路由抽离为单独模块的步骤如下：</p></blockquote> <ul><li>创建路由模块对应的.js文件</li> <li>调用express.Router()函数创建路由对象</li> <li>向路由挂载具体路由</li> <li>使用module.exports向外共享路由对象</li> <li>使用app.use()函数注册路由模块</li></ul> <h6 id="创建路由模块"><a href="#创建路由模块" class="header-anchor">#</a> 创建路由模块</h6> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在创建的js文件中./router/user.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span> <span class="token comment">//导入express</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//创建路由对象</span>

<span class="token comment">// 挂载路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/list'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Get user list.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/add'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Add new user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router

<span class="token comment">// 注册路由模块导入路由模块</span>
<span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router/user.js'</span><span class="token punctuation">)</span>
<span class="token comment">// 使用app.use()注册路由模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>userRouter<span class="token punctuation">)</span>
<span class="token comment">// 也可以添加前缀app.use()注册路由模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span>userRouter<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="express中间件"><a href="#express中间件" class="header-anchor">#</a> Express中间件</h3> <h4 id="中间件的概念"><a href="#中间件的概念" class="header-anchor">#</a> 中间件的概念</h4> <blockquote><p>中间件（Middleware ），特指业务流程的中间处理环节。</p></blockquote> <h5 id="express中间件的调用流程"><a href="#express中间件的调用流程" class="header-anchor">#</a> Express中间件的调用流程</h5> <blockquote><p>当一个请求到达 Express 的服务器之后，可以连续调用多个中间件，从而对这次请求进行预处理。
<img src="/assets/img/Express.9dec2a63.png" alt="Express"></p></blockquote> <h5 id="express中间件格式"><a href="#express中间件格式" class="header-anchor">#</a> Express中间件格式</h5> <p>Express 的中间件，本质上就是一个 function 处理函数，Express 中间件的格式如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>注意：中间件函数的形参列表中，必须包含 next 参数。而路由处理函数中只包含 req 和 res。</p></div> <h5 id="next函数的作用"><a href="#next函数的作用" class="header-anchor">#</a> next函数的作用</h5> <blockquote><p>next 函数是实现多个中间件连续调用的关键，它表示把流转关系转交给下一个中间件或路由。
<img src="/assets/img/express02.15d2cb0d.png" alt="exp02"></p></blockquote> <h4 id="express中间件的初体验"><a href="#express中间件的初体验" class="header-anchor">#</a> Express中间件的初体验</h4> <h5 id="_1-定义中间件函数"><a href="#_1-定义中间件函数" class="header-anchor">#</a> 1.定义中间件函数</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 常量mv所指向的，就是一个中间件函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">mv</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是一个中件间函数'</span><span class="token punctuation">)</span>
    <span class="token comment">// 注意：当前中间件处理完毕后，必须调用next()函数</span>
    <span class="token comment">// 表示：把流转关系交给下一个中间件或路由</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="_2-全局生效的中间件"><a href="#_2-全局生效的中间件" class="header-anchor">#</a> 2.全局生效的中间件</h5> <p>客户端发起的任何请求，到达服务器之后，<strong>都会触发的中间件</strong>，叫做全局生效的中间件。
通过调用 <strong>app.use(中间件函数)</strong>，即可定义一个<strong>全局生效的中间件</strong>。</p> <h5 id="_3-局部生效的中间件"><a href="#_3-局部生效的中间件" class="header-anchor">#</a> 3.局部生效的中间件</h5> <p>不使用 app.use() 定义的中间件，叫做局部生效的中间件，示例代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 定义中间件函数mv1</span>
<span class="token keyword">const</span> <span class="token function-variable function">mv1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'中间件函数'</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">mv2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'中间件函数'</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 局部生效：当前路由中生效</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>mv1<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 多个局部中间件</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>mv1<span class="token punctuation">,</span>mv2<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="_3-中间件的作用"><a href="#_3-中间件的作用" class="header-anchor">#</a> 3.中间件的作用</h5> <p>多个中间件之间，<strong>共享同一份 req 和 res</strong>。基于这样的特性，我们可以在<strong>上游</strong>的中间件中，统一为 req 或 res 对象添加<strong>自定义</strong>的<strong>属性</strong>或<strong>方法</strong>，供<strong>下游</strong>的中间件或路由进行使用。</p> <h5 id="_4-中间件的注意事项"><a href="#_4-中间件的注意事项" class="header-anchor">#</a> 4.中间件的注意事项</h5> <ul><li>一定要在<strong>路由之前</strong>注册中间件</li> <li>客户端发送过来的请求，<strong>可以连续调用多个</strong>中间件进行处理</li> <li>执行完中间件的业务代码之后，<strong>不要忘记调用 next() 函数</strong></li> <li>为了<strong>防止代码逻辑混乱</strong>，调用 next() 函数后不要再写额外的代码</li> <li>连续调用多个中间件时，多个中间件之间，<strong>共享</strong> req 和 res 对象</li></ul> <h4 id="中间件的分类"><a href="#中间件的分类" class="header-anchor">#</a> 中间件的分类</h4> <ul><li><strong>应用级别</strong>的中间件</li> <li><strong>路由级别</strong>的中间件</li> <li><strong>错误级别</strong>的中间件</li> <li><strong>Express内置</strong>的中间件</li> <li><strong>第三方</strong>的中间件</li></ul> <h5 id="_1-应用级别的中间件"><a href="#_1-应用级别的中间件" class="header-anchor">#</a> 1.应用级别的中间件</h5> <p>通过 app.use() 或 app.get() 或 app.post() ，绑定到 app 实例上的中间件，叫做应用级别的中间件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 应用级别的中间件(全局中间件)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 应用级别中间件(局部中间件)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>mv1<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'home page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_2-路由级别的中间件"><a href="#_2-路由级别的中间件" class="header-anchor">#</a> 2.路由级别的中间件</h5> <p>绑定到 <strong>express.Router()</strong> 实例上的中间件，叫做路由级别的中间件。它的用法和应用级别中间件没有任何区别。只不过，<strong>应用级别中间件是绑定到 app 实例上，路由级别中间件绑定到 router 实例上</strong></p> <h5 id="_3-错误级别的中间件"><a href="#_3-错误级别的中间件" class="header-anchor">#</a> 3.错误级别的中间件</h5> <p>错误级别中间件的<strong>作用</strong>：专门用来捕获整个项目中发生的异常错误，从而防止项目异常崩溃的问题。
<strong>格式</strong>：错误级别中间件的 function 处理函数中，<strong>必须有 4 个形参</strong>，形参顺序从前到后，分别是 (err, req, res, next)。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//路由</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'服务器内部发送了错误！'</span><span class="token punctuation">)</span>   <span class="token comment">//抛出异常</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//错误级别中间件</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发生了错误：'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// 在服务器打印错误消息</span>
    res<span class="token punctuation">,</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token operator">+</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>   <span class="token comment">// 发送给客户端错误相关信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>注意：错误级别的中间件，必须注册在所有路由之后</p></div> <h5 id="_4-express内置的中间件"><a href="#_4-express内置的中间件" class="header-anchor">#</a> 4.Express内置的中间件</h5> <blockquote><p>自 Express 4.16.0 版本开始，Express 内置了 3 个常用的中间件，极大的提高了 Express 项目的开发效率和体验：</p></blockquote> <ul><li>express.static 快速托管静态资源的内置中间件，例如： HTML 文件、图片、CSS 样式等（无兼容性）</li> <li>express.json 解析 JSON 格式的请求体数据（有兼容性，仅在 4.16.0+ 版本中可用）</li> <li>express.urlencoded 解析 URL-encoded 格式的请求体数据（有兼容性，仅在 4.16.0+ 版本中可用）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 配置解析application/json格式数据的内置中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 配置解析application/x-www-form-urlencoded格式数据的内置中间插件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">extended</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="_5-第三方的中间件"><a href="#_5-第三方的中间件" class="header-anchor">#</a> 5.第三方的中间件</h5> <blockquote><p>非 Express 官方内置的，而是由第三方开发出来的中间件，叫做第三方中间件。在项目中，大家可以按需下载并配置第三方中间件，从而提高项目的开发效率</p></blockquote> <h3 id="使用express写接口"><a href="#使用express写接口" class="header-anchor">#</a> 使用Express写接口</h3> <h4 id="cors跨域资源共享"><a href="#cors跨域资源共享" class="header-anchor">#</a> CORS跨域资源共享</h4> <ul><li>CORS(主流的解决方案，推荐使用)</li> <li>JSONP(有缺陷的解决方案:只支持GET请求)</li></ul> <h5 id="使用cors中间件解决跨域问题"><a href="#使用cors中间件解决跨域问题" class="header-anchor">#</a> 使用CORS中间件解决跨域问题</h5> <blockquote><p>cors 是 Express 的一个第三方中间件。通过安装和配置 cors 中间件，可以很方便地解决跨域问题。
使用步骤分为如下 3 步：</p></blockquote> <ul><li>运行 npm install cors 安装中间件</li> <li>使用 const cors = require('cors') 导入中间件</li> <li>在路由之前调用 app.use(cors()) 配置中间件</li></ul> <h5 id="什么是cors"><a href="#什么是cors" class="header-anchor">#</a> 什么是CORS</h5> <blockquote><p>CORS （Cross-Origin Resource Sharing，跨域资源共享）由一系列 HTTP 响应头组成，这些 HTTP 响应头决定浏览器是否阻止前端 JS 代码跨域获取资源。
浏览器的同源安全策略默认会阻止网页“跨域”获取资源。但如果接口服务器配置了 CORS 相关的 HTTP 响应头，就可以解除浏览器端的跨域访问限制。</p></blockquote> <h5 id="cors注意事项"><a href="#cors注意事项" class="header-anchor">#</a> CORS注意事项</h5> <ul><li>CORS 主要在<strong>服务器端</strong>进行配置。客户端浏览器无须做<strong>任何额外的配置</strong>，即可请求开启了 CORS 的接口。</li> <li>CORS 在浏览器中有兼容性。只有支持 XMLHttpRequest Level2 的浏览器，才能正常访问开启了 CORS 的服务端接口（例如：IE10+、Chrome4+、FireFox3.5+）。</li></ul> <h2 id="数据库与身份认证"><a href="#数据库与身份认证" class="header-anchor">#</a> 数据库与身份认证</h2> <h3 id="数据库的基本概念"><a href="#数据库的基本概念" class="header-anchor">#</a> 数据库的基本概念</h3> <h4 id="什么是数据库"><a href="#什么是数据库" class="header-anchor">#</a> 什么是数据库</h4> <blockquote><p>数据库（database）是用来组织、存储和管理数据的仓库。
当今世界是一个充满着数据的互联网世界，充斥着大量的数据。数据的来源有很多，比如出行记录、消费记录、浏览的网页、发送的消息等等。除了文本类型的数据，图像、音乐、声音都是数据。
为了方便管理互联网世界中的数据，就有了数据库管理系统的概念（简称：数据库）。用户可以对数据库中的数据进行新增、查询、更新、删除等操作。</p></blockquote> <h4 id="常见的数据库及分类"><a href="#常见的数据库及分类" class="header-anchor">#</a> 常见的数据库及分类</h4> <ul><li>Mysql数据库(目前使用最广泛、流行度最高的开源免费数据库；Community + Enterprise)</li> <li>Oracle数据库(收费)</li> <li>SQL Server数据库(收费)</li> <li>Mongobd数据库(Community + Enterprise)
其中，MySQL、Oracle、SQL Server 属于<strong>传统型数据库</strong>（又叫做：<strong>关系型数据库</strong> 或 <strong>SQL 数据库</strong>），这三者的设计理念相同，用法比较类似。
而 Mongodb 属于<strong>新型数据库</strong>（又叫做：<strong>非关系型数据库</strong> 或 <strong>NoSQL 数据库</strong>），它在一定程度上弥补了传统型数据库的缺陷。</li></ul> <h3 id="mysql的基本使用"><a href="#mysql的基本使用" class="header-anchor">#</a> MySQL的基本使用</h3> <h4 id="什么是sql"><a href="#什么是sql" class="header-anchor">#</a> 什么是SQL</h4> <blockquote><p>SQL（英文全称：Structured Query Language）是结构化查询语言，专门用来访问和处理数据库的编程语言。能够让我们以编程的形式，操作数据库里面的数据。</p></blockquote> <h4 id="sql学习目标-增删查改"><a href="#sql学习目标-增删查改" class="header-anchor">#</a> SQL学习目标(增删查改)</h4> <ul><li><strong>查询数据</strong>(select)</li> <li><strong>插入数据</strong>(insert into)</li> <li><strong>更新数据</strong>(update)</li> <li><strong>删除数据</strong>(delete)
4中SQL语法:
<strong>where条件</strong>、<strong>and和or运算符</strong>、<strong>rder by排序</strong>、<strong>count(*)函数</strong></li></ul> <h4 id="sql的select语句"><a href="#sql的select语句" class="header-anchor">#</a> SQL的SELECT语句</h4> <p>语法：</p> <div class="language-SQL line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 这是注释</span>
<span class="token comment">-- 从FROM指定[表中],查询出[所有的]数据。*表示[所有列]</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表名称

<span class="token comment">-- 从FROM指定[表中],查询出[指定列]数据。</span>
<span class="token keyword">SELECT</span> 列名称 <span class="token keyword">FROM</span> 表名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>注意：SQL 语句中的关键字对大小写不敏感。SELECT 等效于 select，FROM 等效于 from</p></div> <h4 id="sql的insert-into-语句"><a href="#sql的insert-into-语句" class="header-anchor">#</a> SQL的INSERT INTO 语句</h4> <p>语法</p> <div class="language-SQL line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 语法解读：向指定的表中,插入如下几列数据,列的值通过Values ——指定</span>
<span class="token comment">-- 注意：列和值要一对应,多个列和多个值之间,使用英文的逗号分隔</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名<span class="token punctuation">(</span>列名<span class="token punctuation">,</span>列名<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span>值<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="sql的update语句"><a href="#sql的update语句" class="header-anchor">#</a> SQL的UPDATE语句</h4> <div class="language-SQL line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 语法解读：</span>
<span class="token comment">-- 1.用UPDATE指定要更新那个表中的数据</span>
<span class="token comment">-- 2.用SET指定列对应的新值</span>
<span class="token comment">-- 3.用WHERE指定更新的条件</span>
<span class="token keyword">UPDATE</span> 表名称 <span class="token keyword">SET</span> 列名称 <span class="token operator">=</span> 新值 <span class="token keyword">WHERE</span> 列名称 <span class="token operator">=</span> 某值
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="sql的delete语句"><a href="#sql的delete语句" class="header-anchor">#</a> SQL的DELETE语句</h4> <p>语法</p> <div class="language-SQL line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 语法解读：</span>
<span class="token comment">-- 从指定表中，根据where条件，删除对应的数据行</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 表名称 <span class="token keyword">WHERE</span> 列名称 <span class="token operator">=</span> 值
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="sql的where子句"><a href="#sql的where子句" class="header-anchor">#</a> SQL的WHERE子句</h4> <blockquote><p>WHERE 子句用于限定选择的标准。在 SELECT、UPDATE、DELETE 语句中，皆可使用 WHERE 子句来限定选择的标准。
语法:</p></blockquote> <div class="language-SQL line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询语句中的WHERE条件</span>
<span class="token keyword">SELECT</span> 列名称 <span class="token keyword">FROM</span> 表名称 <span class="token keyword">WHERE</span> 列 运算符 值
<span class="token comment">-- 更新语句中的WHERE条件</span>
<span class="token keyword">UPDATE</span> 表名称 <span class="token keyword">SET</span> 列 <span class="token operator">=</span> 新值 <span class="token keyword">WHERE</span> 列 运算符 值
<span class="token comment">-- 删除语句的WHERE条件</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 表名称 <span class="token keyword">WHERE</span> 列 运算符 值
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="sql的where可使用的运算符"><a href="#sql的where可使用的运算符" class="header-anchor">#</a> SQL的WHERE可使用的运算符</h4> <table><thead><tr><th>操作符</th> <th>描述</th></tr></thead> <tbody><tr><td>=</td> <td>等于</td></tr> <tr><td>&lt;&gt;</td> <td>不等于</td></tr> <tr><td>&gt;</td> <td>大于</td></tr> <tr><td>&lt;</td> <td>小于</td></tr> <tr><td>&gt;=</td> <td>大于等于</td></tr> <tr><td>&lt;=</td> <td>小于等于</td></tr> <tr><td>BETWEEN</td> <td>在某个范围内</td></tr> <tr><td>LIKE</td> <td>搜索某种模式</td></tr></tbody></table> <h4 id="sql的and和or运算符"><a href="#sql的and和or运算符" class="header-anchor">#</a> SQL的AND和OR运算符</h4> <p>语法</p> <ul><li>AND 和 OR 可在 WHERE 子语句中把两个或多个条件结合起来。</li> <li>AND 表示必须同时满足多个条件，相当于 JavaScript 中的 &amp;&amp; 运算符，例如 if (a !== 10 &amp;&amp; a !== 20)</li> <li>OR 表示只要满足任意一个条件即可，相当于 JavaScript 中的 || 运算符，例如 if(a !== 10 || a !== 20)</li></ul> <h4 id="sql的order-by-子句"><a href="#sql的order-by-子句" class="header-anchor">#</a> SQL的ORDER BY 子句</h4> <p>语法</p> <ul><li>ORDER BY语句用指定根据指定的列对结果集进行排序。</li> <li>ORDER BY 语句默认按照升序对记录进行排序。</li> <li>如果您希望按照降序对记录进行排序，可以使用 DESC 关键字。</li></ul> <div class="language-SQL line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 注意：如下两条SQL语句是等价。</span>
<span class="token comment">--  因为ORDER BY 默认进行升序排序</span>
<span class="token comment">--  其中,ASC关键字代表降序排序</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段   <span class="token comment">-- 升序</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段 <span class="token keyword">ASC</span>  <span class="token comment">-- 降序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="sql的count-函数"><a href="#sql的count-函数" class="header-anchor">#</a> SQL的COUNT(*)函数</h4> <p>语法：
COUNT(*) 函数用于返回查询结果的总数据条数，语法格式如下：
<code>SELECT COUNT(*) FROM 表名称</code></p> <h4 id="as为列设置别名"><a href="#as为列设置别名" class="header-anchor">#</a> AS为列设置别名</h4> <p><code>SELECT COUNT(*)AS total FROM users WHERE status=0</code></p> <h3 id="在项目中操作mysql"><a href="#在项目中操作mysql" class="header-anchor">#</a> 在项目中操作MySQL</h3> <h4 id="项目中操着数据的步骤"><a href="#项目中操着数据的步骤" class="header-anchor">#</a> 项目中操着数据的步骤</h4> <ul><li>1、安装操作MySQL数据库的第三方模块(mysql)</li> <li>2、通过MySQL模块连接到MySQL数据库</li> <li>3、通过MySQL模块执行SQL语句</li></ul> <h5 id="_1、安装mysql模块"><a href="#_1、安装mysql模块" class="header-anchor">#</a> 1、安装mysql模块</h5> <blockquote><p>mysql 模块是托管于 npm 上的第三方模块。它提供了在 Node.js 项目中连接和操作 MySQL 数据库的能力。
想要在项目中使用它，需要先运行如下命令，将 mysql 安装为项目的依赖包：
<code>npm install mysql</code></p></blockquote> <h5 id="_2、配置mysql模块"><a href="#_2、配置mysql模块" class="header-anchor">#</a> 2、配置mysql模块</h5> <blockquote><p>在使用 mysql 模块操作 MySQL 数据库之前，必须先对 mysql 模块进行必要的配置，主要的配置步骤如下：</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1、导入mySQL模块</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span>
<span class="token comment">// 2、建立与MySQL数据库的连接</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">//数据库的IP地址</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>    <span class="token comment">// 数据库账号</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">'admin123'</span><span class="token punctuation">,</span><span class="token comment">//登录数据库密码</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span><span class="token string">'my_db_01'</span> <span class="token comment">//指定操作那个数据库</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3、检测mysql模块是否能正常工作</span>
db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select 1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>results</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token comment">// 只要打印出[Rowdatapacket{'1':1}]的结果,就证明数据库连接正常</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 查询数据</span>
db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select * from user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>results</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ressults<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="前后的的身份认证"><a href="#前后的的身份认证" class="header-anchor">#</a> 前后的的身份认证</h3> <h4 id="web开发模式"><a href="#web开发模式" class="header-anchor">#</a> Web开发模式</h4> <p>目前主流的Web开发模式有两种,分别是:</p> <ul><li>1、基于服务端渲染的传统Web开发模式</li> <li>2、基于前后端分离的新型Web开发模式</li></ul> <h5 id="_1-服务端渲染的-web-开发模式"><a href="#_1-服务端渲染的-web-开发模式" class="header-anchor">#</a> 1. 服务端渲染的 Web 开发模式</h5> <blockquote><p>服务端渲染的概念：服务器发送给客户端的 HTML 页面，是在服务器通过字符串的拼接，动态生成的。因此，客户端不需要使用 Ajax 这样的技术额外请求页面的数据。代码示例如下：</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 要渲染的数据</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span>
    <span class="token comment">// 服务端通过字符串的拼接,动态生成HTML内容</span>
    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;姓名：$(user.name)&lt;/h1&gt;'</span>
    <span class="token comment">// 把生成好的页面内容响应给客户端,因此,客户端拿到的是带有真是数据的HTML页面</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_2-前后端分离的web开发模式"><a href="#_2-前后端分离的web开发模式" class="header-anchor">#</a> 2. 前后端分离的Web开发模式</h5> <blockquote><p>前后端分离的概念：前后端分离的开发模式，依赖于 Ajax 技术的广泛应用。简而言之，前后端分离的 Web 开发模式，就是后端只负责提供 API 接口，前端使用 Ajax 调用接口的开发模式。</p></blockquote> <h4 id="身份认证"><a href="#身份认证" class="header-anchor">#</a> 身份认证</h4> <h5 id="_1-什么是身份认证"><a href="#_1-什么是身份认证" class="header-anchor">#</a> 1.什么是身份认证</h5> <blockquote><p>身份认证（Authentication）又称“身份验证”、“鉴权”，是指通过一定的手段，完成对用户身份的确认。</p></blockquote> <h5 id="_2-不同开发模式的身份认证"><a href="#_2-不同开发模式的身份认证" class="header-anchor">#</a> 2.不同开发模式的身份认证</h5> <p>对于服务端渲染和前后端分离这两种开发模式来说，分别有着不同的身份认证方案：</p> <ul><li>服务端渲染推荐使用 Session 认证机制</li> <li>前后端分离推荐使用 JWT 认证机制</li></ul> <h5 id="session认证机制"><a href="#session认证机制" class="header-anchor">#</a> Session认证机制</h5> <h6 id="_1-http协议的无状态性"><a href="#_1-http协议的无状态性" class="header-anchor">#</a> 1.HTTP协议的无状态性</h6> <blockquote><p>HTTP 协议的无状态性，指的是<strong>客户端的每次 HTTP 请求都是独立的</strong>，连续多个请求之间没有直接的关系，<strong>服务器不会主动保留每次 HTTP 请求的状态</strong>。</p></blockquote> <h6 id="_2-如何突破-http-无状态的限制"><a href="#_2-如何突破-http-无状态的限制" class="header-anchor">#</a> 2.如何突破 HTTP 无状态的限制</h6> <blockquote><p>对于超市来说，为了方便收银员在进行结算时给 VIP 用户打折，超市可以为每个 VIP 用户发放会员卡。
现实生活中的会员卡身份认证方式，在 Web 开发中的专业术语叫做 <strong>Cookie</strong>。</p></blockquote> <h6 id="_3-什么是cookie"><a href="#_3-什么是cookie" class="header-anchor">#</a> 3.什么是Cookie</h6> <blockquote><p>Cookie 是存储在用户浏览器中的一段不超过 4 KB 的字符串。它由一个名称（Name）、一个值（Value）和其它几个用于控制 Cookie 有效期、安全性、使用范围的可选属性组成。
不同域名下的 Cookie 各自独立，每当客户端发起请求时，会<strong>自动</strong>把当前域名下所有<strong>未过期的 Cookie</strong> 一同发送到服务器。
<strong>Cookie的几大特性：</strong></p></blockquote> <ul><li>1.自动发送</li> <li>2.域名独立</li> <li>3.过期时限</li> <li>4.4KB限制</li></ul> <h6 id="_4-cookie在身份认证中的作用"><a href="#_4-cookie在身份认证中的作用" class="header-anchor">#</a> 4.Cookie在身份认证中的作用</h6> <p>客户端第一次请求服务器的时候，服务器通过<strong>响应头的形式</strong>，向客户端发送一个身份认证的 Cookie，客户端会自动将 Cookie 保存在浏览器中。
随后，当客户端浏览器每次请求服务器的时候，浏览器会<strong>自动</strong>将身份认证相关的 Cookie，<strong>通过请求头的形式</strong>发送给服务器，服务器即可验明客户端的身份。</p> <h6 id="_5-cookie-不具有安全性"><a href="#_5-cookie-不具有安全性" class="header-anchor">#</a> 5.Cookie 不具有安全性</h6> <p>由于 Cookie 是存储在浏览器中的，而且<strong>浏览器也提供了读写 Cookie 的 API</strong>，因此 <strong>Cookie 很容易被伪造</strong>，不具有安全性。因此不建议服务器将重要的隐私数据，通过 Cookie 的形式发送给浏览器。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>注意：千万不要使用 Cookie 存储重要且隐私的数据！比如用户的身份信息、密码等</p></div> <h6 id="_6-提高身份认证的安全性"><a href="#_6-提高身份认证的安全性" class="header-anchor">#</a> 6.提高身份认证的安全性</h6> <p>为了防止客户伪造会员卡，收银员在拿到客户出示的会员卡之后，可以在收银机上进行刷卡认证。只有收银机确认存在的会员卡，才能被正常使用。
这种“<strong>会员卡</strong> + <strong>刷卡认证</strong>”的设计理念，就是 Session 认证机制的精髓。</p> <h6 id="_7-session-的工作原理"><a href="#_7-session-的工作原理" class="header-anchor">#</a> 7. Session 的工作原理</h6> <p><img src="/assets/img/Session.0f37e2ea.png" alt="Session"></p> <h5 id="在-express-中使用-session-认证"><a href="#在-express-中使用-session-认证" class="header-anchor">#</a> 在 Express 中使用 Session 认证</h5> <h6 id="_1-安装-express-session-中间件"><a href="#_1-安装-express-session-中间件" class="header-anchor">#</a> 1.<strong>安装</strong> express-session 中间件</h6> <p>在 Express 项目中，只需要安装 express-session 中间件，即可在项目中使用 Session 认证：
<code>npm install express-session</code></p> <h6 id="_2-配置-express-session-中间件"><a href="#_2-配置-express-session-中间件" class="header-anchor">#</a> 2.<strong>配置</strong> express-session 中间件</h6> <p>express-session 中间件安装成功后，需要通过 app.use() 来注册 session 中间件，示例代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1、导入session中间件</span>
<span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span>
<span class="token comment">// 2、配置Session中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">secret</span><span class="token operator">:</span><span class="token string">'keyboard cat'</span><span class="token punctuation">,</span><span class="token comment">// secret属性值可以为任意字符串(随便写)</span>
    <span class="token literal-property property">resave</span><span class="token operator">:</span>flase <span class="token comment">//resave是指每次请求都重新设置session cookie，假设你的cookie是10分钟过期，每次请求都会再设置10分钟</span>
    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">//aveUninitialized是指无论有没有session cookie，每次请求都设置个session cookie ，默认给个标示为 connect.sid</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h6 id="_3-向-session-中存数据"><a href="#_3-向-session-中存数据" class="header-anchor">#</a> 3.向 session 中存数据</h6> <p>当 express-session 中间件配置成功后，即可通过 <strong>req.session</strong> 来访问和使用 session 对象，从而存储用户的关键信息：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 判断用户提交登录信息是否正确</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">'admin'</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">!==</span> <span class="token string">'000000'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'登录失败'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> req<span class="token punctuation">.</span>body <span class="token comment">//将用户信息,存储到Session中</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>islogin <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//将用户登录状态存储到Session中</span>

    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'登录成功'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h6 id="_4-从-session-中取数据"><a href="#_4-从-session-中取数据" class="header-anchor">#</a> 4.从 session 中取数据</h6> <p>可以直接从 req.session 对象上获取之前存储的数据，示例代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取用户姓名接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/username'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 判断用户是否登录</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>islogin<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'fail'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="token literal-property property">username</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h6 id="_5-清空-session"><a href="#_5-清空-session" class="header-anchor">#</a> 5. 清空 session</h6> <p>调用 <strong>req.session.destroy()</strong> 函数，即可清空服务器保存的 session 信息。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 退出登录接口</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/logout'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 清空当前客户端对应的session信息</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">statis</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'退出登录成功'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="jwt-认证机制"><a href="#jwt-认证机制" class="header-anchor">#</a> JWT 认证机制</h5> <h6 id="_1-了解session认证的局限性"><a href="#_1-了解session认证的局限性" class="header-anchor">#</a> 1.了解Session认证的局限性</h6> <blockquote><p>Session 认证机制<strong>需要配合 Cookie 才能实现</strong>。由于 Cookie 默认不支持跨域访问，所以，当<strong>涉及到前端跨域请求后端接口</strong>的时候，<strong>需要做很多额外的配置</strong>，才能实现跨域 Session 认证。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">注意</p> <ul><li>当前端请求后端接口不存在跨域问题的时候，推荐使用 Session 身份认证机制。</li> <li>当前端需要跨域请求后端接口的时候，不推荐使用 Session 身份认证机制，推荐使用 JWT 认证机制。</li></ul></div> <h6 id="_2-什么是-jwt"><a href="#_2-什么是-jwt" class="header-anchor">#</a> 2. 什么是 JWT</h6> <blockquote><p>JWT（英文全称：JSON Web Token）是目前最流行的跨域认证解决方案。</p></blockquote> <h6 id="_3-jwt-的工作原理"><a href="#_3-jwt-的工作原理" class="header-anchor">#</a> 3. JWT 的工作原理</h6> <p><img src="/assets/img/JWT.9961994f.png" alt="jwt">
总结：用户的信息通过 Token 字符串的形式，保存在客户端浏览器中。服务器通过还原 Token 字符串的形式来认证用户的身份。</p> <h6 id="_4-jwt-的组成部分"><a href="#_4-jwt-的组成部分" class="header-anchor">#</a> 4. JWT 的组成部分</h6> <blockquote><p>JWT 通常由三部分组成，分别是 Header（头部）、Payload（有效荷载）、Signature（签名）。
三者之间使用英文的“.”分隔，格式如下：
<code>Header.payload.Signature</code></p></blockquote> <h6 id="_5-jwt-的三个部分各自代表的含义"><a href="#_5-jwt-的三个部分各自代表的含义" class="header-anchor">#</a> 5. JWT 的三个部分各自代表的含义</h6> <p>JWT 的三个组成部分，从前到后分别是 Header、Payload、Signature。
其中：</p> <ul><li><strong>Payload</strong> 部分才是真正的用户信息**，它是用户信息经过加密之后生成的字符串。</li> <li>Header 和 Signature 是<strong>安全性相关</strong>的部分，只是为了保证 Token 的安全性。</li></ul> <h6 id="_7-jwt-的使用方式"><a href="#_7-jwt-的使用方式" class="header-anchor">#</a> 7. JWT 的使用方式</h6> <p>客户端收到服务器返回的 JWT 之后，通常会将它储存在 <strong>localStorage</strong> 或 <strong>sessionStorage</strong> 中。
此后，客户端每次与服务器通信，都要带上这个 JWT 的字符串，从而进行身份认证。推荐的做法是把 <strong>JWT 放在 HTTP 请求头的 Authorization 字段中</strong>，格式如下：
<code>Authorization:Bearer&lt;token&gt;</code></p> <h5 id="在-express-中使用-jwt"><a href="#在-express-中使用-jwt" class="header-anchor">#</a> 在 Express 中使用 JWT</h5> <h6 id="_1-安装-jwt-相关的包"><a href="#_1-安装-jwt-相关的包" class="header-anchor">#</a> 1. 安装 JWT 相关的包</h6> <p>运行如下命令，安装如下两个 JWT 相关的包：
<code>npm install jsonwebtoken express-jwt</code>
其中：</p> <ul><li>jsonwebtoken 用于生成 JWT 字符串</li> <li>express-jwt 用于将 JWT 字符串解析还原成 JSON 对象</li></ul> <h6 id="_2-导入-jwt-相关的包"><a href="#_2-导入-jwt-相关的包" class="header-anchor">#</a> 2. 导入 JWT 相关的包</h6> <p>使用 require() 函数，分别导入 JWT 相关的两个包</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sonwebtoken'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> expressJWT <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-jwt'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h6 id="_3-定义-secret-密钥"><a href="#_3-定义-secret-密钥" class="header-anchor">#</a> 3. 定义 secret 密钥</h6> <p>为了保证 JWT 字符串的安全性，防止 JWT 字符串在网络传输过程中被别人破解，我们需要专门定义一个用于加密和解密的 secret 密钥：</p> <ul><li>当生成 JWT 字符串的时候，需要使用 secret 密钥对用户的信息进行加密，最终得到加密好的 JWT 字符串</li> <li>当把 JWT 字符串解析还原成 JSON 对象的时候，需要使用 secret 密钥进行解密</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 3.secret 密钥的本质：就是一个字符串</span>
<span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">'HELLO WORLD!^_^'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h6 id="_4-在登录成功后生成-jwt-字符串"><a href="#_4-在登录成功后生成-jwt-字符串" class="header-anchor">#</a> 4.在登录成功后生成 JWT 字符串</h6> <p>调用 jsonwebtoken 包提供的 sign() 方法，将用户的信息加密成 JWT 字符串，响应给客户端：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 登录接口</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 登录之后代码。。。。</span>
    <span class="token comment">// 登录成功后，生成JWT字符串，通过token属性响应给客户端</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mes</span><span class="token operator">:</span><span class="token string">'登录成功'</span><span class="token punctuation">,</span>
        <span class="token comment">// 调用jwt.sign()生成JWT字符串,三个参数分别是：用户信息、secret密钥、配置对象时效</span>
        <span class="token literal-property property">token</span><span class="token operator">:</span>jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">username</span><span class="token operator">:</span>userinfo<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token punctuation">,</span>secretKey<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">expiresIn</span><span class="token operator">:</span><span class="token string">'30s'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h6 id="_5-将-jwt-字符串还原为-json-对象"><a href="#_5-将-jwt-字符串还原为-json-对象" class="header-anchor">#</a> 5. 将 JWT 字符串还原为 JSON 对象</h6> <p>客户端每次在访问那些有权限接口的时候，都需要主动通过<strong>请求头中的 Authorization 字段</strong>，将 Token 字符串发送到服务器进行身份认证。
此时，服务器可以通过 <strong>express-jwt</strong> 这个中间件，自动将客户端发送过来的 Token 解析还原成 JSON 对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//使用app.use()来注册中间件</span>
<span class="token comment">// expressJWT({secret:secretKey})解析token中间件</span>
<span class="token comment">// .unless({path:[/^\api\//]})用来指定那些接口不需要访问权限</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">expressJWT</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">secret</span><span class="token operator">:</span>secretKey<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h6 id="_6-使用-req-user-获取用户信息"><a href="#_6-使用-req-user-获取用户信息" class="header-anchor">#</a> 6. 使用 req.user 获取用户信息</h6> <p>当 express-jwt 这个中间件配置成功之后，即可在那些有权限的接口中，使用 <strong>req.user</strong> 对象，来访问从 JWT 字符串中解析出来的用户信息了，示例代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/getinfo'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">'获取用户信息成功！'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>req<span class="token punctuation">.</span>user
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h6 id="_7-捕获解析-jwt-失败后产生的错误"><a href="#_7-捕获解析-jwt-失败后产生的错误" class="header-anchor">#</a> 7. 捕获解析 JWT 失败后产生的错误</h6> <p>当使用 express-jwt 解析 Token 字符串时，如果客户端发送过来的 Token 字符串<strong>过期</strong>或<strong>不合法</strong>，会产生一个解析失败的错误，影响项目的正常运行。我们可以通过 <strong>Express 的错误中间件</strong>，捕获这个错误并进行相关的处理，示例代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// token解析失败导致的错误</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'UnauthorizedError'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        retrun res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">401</span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">'无效的token'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 其他原因错误</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">'未知错误'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.32184412.js" defer></script><script src="/assets/js/2.bf4cfade.js" defer></script><script src="/assets/js/3.cb83fe4d.js" defer></script>
  </body>
</html>
